<!DOCTYPE html>
<html>
<body>
<h1>Diagram</h1>
<p><a href="{{ url_for('init') }}">Home</a></p>
<canvas id="myCanvas" width="300" height="300" style="border:1px solid grey"></canvas>
<button onclick="draw_rec()">Draw Problem</button>
<button onclick="get_forces()">Get Forces</button>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
function draw_rec(){
   var canvas = document.getElementById("myCanvas");
   var ctx    = canvas.getContext("2d");
   var startX = 120;
   var startY = 120;
   ctx.save();
   ctx.beginPath();
   ctx.translate(150, 150);
   ctx.rotate(-30*Math.PI/180);
   ctx.rect(-30, -30, 60, 60);
   ctx.fillStyle = "blue";
   ctx.fill();
   ctx.moveTo(-130, 30);
   ctx.lineTo(130, 30);
   ctx.stroke();
   ctx.restore();
}
var x = 0;
var y = 0;
var vector_list = []
var isdrawing = false;
const canvas = document.getElementById("myCanvas");
const ctx    = canvas.getContext("2d");
canvas.addEventListener("mousedown", (e) => {
   x = e.offsetX;
   y = e.offsetY;
   isdrawing = true;
});
canvas.addEventListener("mouseup", (e) => {
   if (isdrawing == true){
      drawLine(x, y, e.offsetX, e.offsetY);
      var vecObj = {"x1": x, "y1": y, "x2": e.offsetX, "y2":e.offsetY};
      vector_list.push(vecObj);
      x = 0;
      y = 0;
      isdrawing = false;
   }
});
function drawLine(x1, y1, x2, y2){
   ctx.beginPath();
   ctx.strokeStyle = "black";
   ctx.lineWith = 1;
   ctx.moveTo(x1, y1);
   ctx.lineTo(x2, y2);
   ctx.stroke();
   ctx.save();
   angle = Math.atan2(y2-y1, x2-x1);
   ctx.translate(x2, y2);
   ctx.rotate(angle);
   ctx.moveTo(0,0);
   ctx.lineTo(0, -10);
   ctx.lineTo(15, 0);
   ctx.lineTo(0, 10);
   ctx.fillStyle = "rgb(72,72,72)";
   ctx.stroke();
   ctx.fill();
   ctx.restore();
   ctx.closePath();
}
function get_forces(){
   vector_string = JSON.stringify(vector_list) 
   $.ajax({
     url: '/diagram',
     type: 'POST',
     contentType: "application/json",
     data: vector_string
  }); 
} 

</script>
</body>
</html> 

